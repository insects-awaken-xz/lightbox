!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.lightbox=i()}(this,function(){"use strict";function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var o,c,h,l,r=function(i,e){var s;return function(t){s||(s=setTimeout(function(){e(t),s=0},i))}},d=function(t){return t.preventDefault()},u=function(i,e){i instanceof HTMLElement&&Object.keys(e).map(function(t){return i.style[t]=e[t]})},p="xz-lightbox",m="xlb",f="xlb-backdrop",v="xlb-info",b="xlb-title",g="xlb-desc",$="xlb-pagination",w="xlb-img",x="xlb-arrow",y="xlb-arrow-right",L="xlb-arrow-left",k="xlb-hide",E="xlb-locked",_="xlb-force-transparent",C="title",R="desc",W="disappeared",A="showing",I="showed",S="disappearing",D={onDisappeared:void 0,onShowing:void 0,onShowed:void 0,onDisappearing:void 0},H={hide:!1,duration:618,offset:100,template:"$index of $total photos"};return new(function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.initial=H,Object.defineProperty(this.option(),"status",{set:this._statusHandle,get:function(){return status},enumerable:!0})}var i,e,s;return i=t,(e=[{key:"option",value:function(i){return Object.keys(i||{}).map(function(t){if(Object.hasOwnProperty.call(D,t)&&"function"!=typeof i[t])throw TypeError("".concat(t," has to be a function."))}),this.opts=Object.assign({},this.initial,i),this.$lightbox&&this._setDuration(),this}},{key:"_build",value:function(){this.$lightbox||(this.calc={},this.album=[],this.isAlbum=!1,this.$lightbox=document.createElement("div"),this.$lightbox.id=m,this.$lightbox.classList.add(m,k),this.$backdrop=document.createElement("div"),this.$backdrop.classList.add(f,_),this.$img=document.createElement("img"),this.$img.classList.add(w),this.$arrowR=document.createElement("div"),this.$arrowR.classList.add(x,y,k,_),this.$arrowL=document.createElement("div"),this.$arrowL.classList.add(x,L,k,_),this.$info=document.createElement("div"),this.$info.classList.add(v,k),this.$pagination=document.createElement("div"),this.$pagination.classList.add($,k),this.$title=document.createElement("div"),this.$title.classList.add(b),this.$desc=document.createElement("div"),this.$desc.classList.add(g),this.$info.appendChild(this.$pagination),this.$info.appendChild(this.$title),this.$info.appendChild(this.$desc),this.$lightbox.appendChild(this.$backdrop),this.$lightbox.appendChild(this.$img),this.$lightbox.appendChild(this.$arrowL),this.$lightbox.appendChild(this.$arrowR),this.$lightbox.appendChild(this.$info),document.body.appendChild(this.$lightbox),this._setDuration(),o=r(33,this._active.bind(this)),c=r(33,this._keyboard.bind(this)),h=r(33,this._prevPage.bind(this)),l=r(33,this._nextPage.bind(this)))}},{key:"_setDuration",value:function(){var t="".concat(this.opts.duration,"ms ease");u(this.$img,{transition:"transform ".concat(t)}),u(this.$info,{transition:"bottom ".concat(t,", left ").concat(t,", width ").concat(t)}),u(this.$backdrop,{transition:"opacity ".concat(t)}),u(this.$arrowR,{transition:"opacity ".concat(t,", border-color 300ms ease")}),u(this.$arrowL,{transition:"opacity ".concat(t,", border-color 300ms ease")})}},{key:"_listen",value:function(){var t=this;this.$img.addEventListener("transitionend",function(){return t.status=t.status===A?I:t.status===S?W:""}),this.$backdrop.addEventListener("click",function(){t.status=S})}},{key:"_inactive",value:function(){var t=this.$el.getBoundingClientRect();this.calc.elW=t.width,this.calc.elH=t.height,u(this.$img,{width:"".concat(this.calc.elW,"px"),height:"".concat(this.calc.elH,"px"),transform:"translate(".concat(t.left,"px, ").concat(t.top,"px) scale(1, 1)")}),this.$backdrop.classList.add(_)}},{key:"_active",value:function(){var t=this.$lightbox.getBoundingClientRect(),i=t.width-this.opts.offset,e=t.height-this.opts.offset;this.calc.originW<=i&&this.calc.originH<=e?this.calc.lastW=this.calc.originW:(this.calc.lastW=i,this.calc.lastW*this.calc.originRatio>e&&(this.calc.lastW=e/this.calc.originRatio));var s=this.calc.lastW*this.calc.originRatio,a=this.calc.lastW/this.calc.elW,n=s/this.calc.elH,o=(i+this.opts.offset-this.calc.elW)/2,c=(e+this.opts.offset-this.calc.elH)/2;u(this.$img,{transform:"translate(".concat(o,"px, ").concat(c,"px) scale(").concat(a,", ").concat(n,")")}),this.$backdrop.classList.remove(_),u(this.$info,{bottom:"".concat((t.height-s)/2-1,"px"),width:"".concat(this.calc.lastW,"px"),left:"".concat((t.width-this.calc.lastW)/2,"px")})}},{key:"_statusHandle",value:function(t){status=t,this.status===W?(this.opts.onDisappeared&&this.opts.onDisappeared(),this.opts.hide&&this.$el.classList.remove(_),this.$lightbox.classList.add(k),u(this.$img,{willChange:"auto"}),document.documentElement.classList.remove(E),window.removeEventListener("touchmove",d),window.removeEventListener("resize",o),this.calc={},this.$el=void 0,this.isAlbum&&(this.album=[],this.$arrowR.classList.add(k),this.$arrowL.classList.add(k))):(this.status===A?(this.opts.onShowing&&this.opts.onShowing(),this.opts.hide&&this.$el.classList.add(_),this.$lightbox.classList.remove(k),this._active(),this.isAlbum&&(this.$pagination.innerText=this.opts.template.replace("$index",this.activeIndex+1).replace("$total",this.album.length),this.$arrowR.classList.remove(k,_),this.$arrowL.classList.remove(k,_))):this.status===I?(this.opts.onShowed&&this.opts.onShowed(),(this.title||this.desc||this.isAlbum)&&(this.$title.innerText=this.title,this.$desc.innerText=this.desc,this.$info.classList.remove(k))):this.status===S&&(this.opts.onDisappearing&&this.opts.onDisappearing(),this._inactive(),this.$info.classList.add(k),this.isAlbum&&(this.$arrowL.removeEventListener("click",h),this.$arrowR.removeEventListener("click",l),this.$img.removeEventListener("click",l),window.removeEventListener("keydown",c),this.$arrowR.classList.add(_),this.$arrowL.classList.add(_))),u(this.$img,{willChange:"transform"}),document.documentElement.classList.add(E),window.addEventListener("touchmove",d),window.addEventListener("resize",o))}},{key:"_keyboard",value:function(t){27!==t.keyCode?37===t.keyCode||65===t.keyCode?this._prevPage():39!==t.keyCode&&68!==t.keyCode&&13!==t.keyCode&&32!==t.keyCode||this._nextPage():this.status=S}},{key:"_prevPage",value:function(){this.activeIndex=--this.activeIndex<0?this.album.length-1:this.activeIndex,this._update(this.album[this.activeIndex])}},{key:"_nextPage",value:function(){this.activeIndex=++this.activeIndex>this.album.length-1?0:this.activeIndex,this._update(this.album[this.activeIndex])}},{key:"_update",value:function(t){var i=this;this.$el&&this.$el.classList.remove(_),this.$el=t,this.title=this.$el.getAttribute(C),this.desc=this.$el.getAttribute(R),this._inactive();var e=new Image,s=this.$el.getAttribute("src");e.src=s,e.onload=function(){i.$img.src=s,i.calc.originW=e.width,i.calc.originH=e.height,i.calc.originRatio=e.height/e.width,i.$img.onload=function(){return i.status=A}},e.onerror=console.error}},{key:"start",value:function(){var s=this;this._build(),this._listen(),window.addEventListener("click",function(t){var i=t.target,e=i.getAttribute(p);if(i.tagName&&"IMG"===i.tagName.toUpperCase()&&"object"!==a(e)){if(e.trim()&&(s.album=document.querySelectorAll("img[".concat(p,'="').concat(e,'"]'))),s.isAlbum=1<s.album.length,s.isAlbum){if(s.activeIndex=Array.prototype.indexOf.call(s.album,i),-1===s.activeIndex)return;s.$pagination.classList.remove(k),s.$arrowL.addEventListener("click",h),s.$arrowR.addEventListener("click",l),s.$img.addEventListener("click",l),window.addEventListener("keydown",c)}else s.$pagination.classList.add(k);s._update(i)}})}}])&&n(i.prototype,e),s&&n(i,s),t}())});
