!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.lightbox=i()}(this,function(){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,i){for(var e=0;e<i.length;e++){var o=i[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t){return function(t){if(Array.isArray(t)){for(var i=0,e=new Array(t.length);i<t.length;i++)e[i]=t[i];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var r,h,c,l,d="xz-lightbox",u="xlb",p="xlb-backdrop",f="xlb-info",g="xlb-title",b="xlb-desc",m="xlb-pagination",v="xlb-photo",$="xlb-arrow",y="xlb-arrow-right",w="xlb-arrow-left",x="xlb-hide",k="xlb-locked",L="xlb-force-transparent",_="title",W="desc",S="disappeared",A="showing",D="showed",E="disappearing",H={onDisappeared:void 0,onShowing:void 0,onShowed:void 0,onDisappearing:void 0},R={hide:!1,duration:618,offset:100,template:"$index of $total photos"},C=function(i){var e,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:33;return function(t){e||(e=setTimeout(function(){i(t),e=0},o))}},O=function(t,i,e){var o,s=document.createElement(t);return e&&(s.id=e),i&&i.length&&(o=s.classList).add.apply(o,a(i)),s},j=function(i,t){return t.map(function(t){return i.appendChild(t)}),i},P=function(t){return t.preventDefault()},T=function(i,e){return Object.keys(e).map(function(t){return i.style[t]=e[t]})},I=function(t){return t?"addEventListener":"removeEventListener"};return new(function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.defaultOpts=R,this.option()}var i,e,o;return i=t,(e=[{key:"_build",value:function(){this.$||(this.$={},this._initData(),this.$.lightbox=O("div",[u,x],u),this.$.backdrop=O("div",[p,L]),this.$.photo=O("img",[v]),this.$.arrowR=O("div",[$,y,x,L]),this.$.arrowL=O("div",[$,w,x,L]),this.$.info=O("div",[f,x,L]),this.$.pagination=O("div",[m,x]),this.$.title=O("div",[g]),this.$.desc=O("div",[b]),j(document.body,[j(this.$.lightbox,[this.$.backdrop,this.$.photo,this.$.arrowL,this.$.arrowR,j(this.$.info,[this.$.pagination,this.$.title,this.$.desc])])]),this._setDuration(),r=C(this._active.bind(this)),h=C(this._keyboard.bind(this)),c=C(this._togglePage.bind(this,!1)),l=C(this._togglePage.bind(this,!0)))}},{key:"_initData",value:function(){this.calc={},this.album={},this.$.el=void 0,this.title="",this.desc="",this.isAlbum=!1,this.status=S}},{key:"_setDuration",value:function(){var t="".concat(this.opts.duration,"ms"),i="ease";T(this.$.photo,{transition:"transform ".concat(t," ").concat(i)}),T(this.$.info,{transition:"bottom ".concat(t," ").concat(i,", left ").concat(t," ").concat(i,", width ").concat(t," ").concat(i,", opacity ").concat(t," ").concat(i)}),T(this.$.backdrop,{transition:"opacity ".concat(t," ").concat(i)}),T(this.$.arrowR,{transition:"opacity ".concat(t," ").concat(i,", border-color 300ms ").concat(i)}),T(this.$.arrowL,{transition:"opacity ".concat(t," ").concat(i,", border-color 300ms ").concat(i)})}},{key:"_listen",value:function(){var o=this;this.$.photo.addEventListener("transitionend",function(){o._setStatus(o.status===A?D:o.status===E?S:D)}),this.$.backdrop.addEventListener("click",function(){o._setStatus(E)}),window.addEventListener("click",function(t){var i=t.target,e=o.album;if(e.name=i.getAttribute(d),i.tagName&&"IMG"===i.tagName.toUpperCase()&&"object"!==s(e.name)){if(e.name.trim()&&(e.photos=document.querySelectorAll("img[".concat(d,'="').concat(e.name,'"]')),o.isAlbum=1<e.photos.length),o.isAlbum){if(e.index=Array.prototype.indexOf.call(e.photos,i),-1===e.index)return void o._initData();o._albumEventListener(!0),o.$.pagination.classList.remove(x)}else o.$.pagination.classList.add(x);o._update(i)}})}},{key:"_inactive",value:function(t){var i=this.calc,e=i.elWidth,o=i.elHeight,s=this.$.el.getBoundingClientRect();i.elWidth=s.width,i.elHeight=s.height,T(this.$.photo,t?{width:"".concat(e,"px"),height:"".concat(o,"px"),transform:"translate(".concat((i.elWidth-e)/2+s.left,"px, ").concat((i.elHeight-o)/2+s.top,"px) \n                  scale(").concat(i.elWidth/e,", ").concat(i.elHeight/o,")")}:{width:"".concat(i.elWidth,"px"),height:"".concat(i.elHeight,"px"),transform:"translate(".concat(s.left,"px, ").concat(s.top,"px) scale(1, 1)")})}},{key:"_active",value:function(){var t=this.calc,i=this.$.lightbox.offsetWidth,e=this.$.lightbox.offsetHeight,o=i-this.opts.offset,s=e-this.opts.offset;t.originWidth<=o&&t.originHeight<=s?t.lastWidth=t.originWidth:(t.lastWidth=o,t.lastWidth*t.originRatio>s&&(t.lastWidth=Math.floor(s/t.originRatio))),t.lastHeight=Math.floor(t.lastWidth*t.originRatio);var n=t.lastWidth/t.elWidth,a=t.lastHeight/t.elHeight,r=(i-t.elWidth)/2,h=(e-t.elHeight)/2;T(this.$.photo,{transform:"translate(".concat(r,"px, ").concat(h,"px) scale(").concat(n,", ").concat(a,")")}),T(this.$.info,{bottom:"".concat((e-t.lastHeight)/2-1,"px"),width:"".concat(t.lastWidth,"px"),left:"".concat((i-t.lastWidth)/2,"px")})}},{key:"_setStatus",value:function(t){var i=this.status;if(this.status=t,i===S&&this.status===A||i===E&&this.status===S){var e=i===S;T(this.$.photo,{willChange:e?"transform":"auto"}),document.documentElement.classList[e?"add":"remove"](k),window[I(e)]("touchmove",P),window[I(e)]("resize",r)}this.status===S?(T(this.$.photo,{transform:"unset"}),this.opts.hide&&this.$.el.classList.remove(L),this.$.lightbox.classList.add(x),this._initData(),this.opts.onDisappeared&&this.opts.onDisappeared()):this.status===A?(i===S?(this.$.lightbox.classList.remove(x),this.$.backdrop.offsetWidth,this.$.backdrop.classList.remove(L)):i===D&&(this.$.info.classList.add(x),this.$.info.offsetWidth,this.$.info.classList.add(L)),this._active(),this.opts.hide&&this.$.el.classList.add(L),this.opts.onShowing&&this.opts.onShowing()):this.status===D?(this.isAlbum&&(this.$.arrowR.classList.remove(x),this.$.arrowL.classList.remove(x),this.$.arrowR.offsetWidth,this.$.arrowL.offsetWidth,this.$.arrowR.classList.remove(L),this.$.arrowL.classList.remove(L)),this.$.info.classList.remove(x),this.$.info.offsetWidth,this.$.info.classList.remove(L),this.opts.onShowed&&this.opts.onShowed()):this.status===E&&(this._inactive(!0),this.$.backdrop.classList.add(L),this.$.info.classList.add(x,L),this.isAlbum&&(this._albumEventListener(!1),this.$.arrowR.classList.add(x,L),this.$.arrowL.classList.add(x,L)),this.opts.onDisappearing&&this.opts.onDisappearing())}},{key:"_keyboard",value:function(t){37===t.keyCode||65===t.keyCode?this._togglePage(!1):39===t.keyCode||68===t.keyCode||13===t.keyCode||32===t.keyCode?this._togglePage(!0):27===t.keyCode&&this._setStatus(E)}},{key:"_togglePage",value:function(t){var i=this.album,e=i.photos,o=e.length;i.index+=t?1:-1,i.index=(i.index+o)%o,this._update(e[i.index],!0)}},{key:"_update",value:function(t,i){var e=this;this.opts.hide&&this.$.el&&this.$.el.classList.remove(L),this.$.el=t,this.title=t.getAttribute(_),this.desc=t.getAttribute(W),this.$.title.innerText=this.title||"",this.$.desc.innerText=this.desc||"",this.isAlbum&&(this.$.pagination.innerText=this.opts.template.replace("$index",this.album.index+1).replace("$total",this.album.photos.length)),!i&&this._inactive();var o=new Image,s=t.getAttribute("src");o.src=s,o.onload=function(){e.$.photo.src=s,e.calc.originWidth=o.width,e.calc.originHeight=o.height,e.calc.originRatio=o.height/o.width,e.$.photo.onload=function(){return e._setStatus(A)}},o.onerror=console.error}},{key:"_albumEventListener",value:function(t){this.$.arrowL[I(t)]("click",c),this.$.arrowR[I(t)]("click",l),this.$.photo[I(t)]("click",l),window[I(t)]("keydown",h)}},{key:"option",value:function(i){return Object.keys(i||{}).map(function(t){if(Object.hasOwnProperty.call(H,t)&&"function"!=typeof i[t])throw TypeError("".concat(t," has to be a function."))}),this.opts=Object.assign({},this.defaultOpts,i),this.$&&this._setDuration(),this}},{key:"start",value:function(){this._build(),this._listen()}}])&&n(i.prototype,e),o&&n(i,o),t}())});
