!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.lightbox=i()}(this,function(){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var a=function(i,e){var s;return function(t){s||(s=setTimeout(function(){e(t),s=0},i))}},c=function(t){return t.preventDefault()},h="xz-lightbox",l="xz-lightbox-backdrop",r="xz-lightbox-img",d="xz-hide",u="xz-locked",p="xz-force-transparent",f="disappeared",g="showing",m="showed",v="disappearing",b={onDisappeared:void 0,onShowing:void 0,onShowed:void 0,onDisappearing:void 0},y={hide:!1,duration:618,offset:60};return new(function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.initial=y,Object.defineProperty(this.option(),"status",{set:this._statusHandle,get:function(){return status}})}var i,e,s;return i=t,(e=[{key:"_build",value:function(){this.$lightbox||(this.calc={},this.$lightbox=document.createElement("div"),this.$lightbox.id=h,this.$lightbox.classList.add(h,d),this.$backdrop=document.createElement("div"),this.$backdrop.classList.add(l,p),this.$img=document.createElement("img"),this.$img.classList.add(r),this._setDuration(),this.$lightbox.appendChild(this.$backdrop),this.$lightbox.appendChild(this.$img),document.body.appendChild(this.$lightbox))}},{key:"_setDuration",value:function(){this.$backdrop.style.transition="opacity ".concat(this.opts.duration,"ms ease"),this.$img.style.transition="transform ".concat(this.opts.duration,"ms ease")}},{key:"_listen",value:function(){var t=this;this.$img.addEventListener("transitionend",function(){return t.status=t.status===g?m:t.status===v?f:""}),this.$lightbox.addEventListener("click",function(){return t.status=v})}},{key:"_inactive",value:function(){var t=this.$el.getBoundingClientRect();this.calc.elW=t.width,this.calc.elH=t.height,this.$img.style.width="".concat(this.calc.elW,"px"),this.$img.style.height="".concat(this.calc.elH,"px"),this.$img.style.transform="translate(".concat(t.left,"px, ").concat(t.top,"px) scale(1, 1)"),this.$backdrop.classList.add(p)}},{key:"_active",value:function(){var t=this.$lightbox.getBoundingClientRect(),i=t.width-this.opts.offset,e=t.height-this.opts.offset;this.calc.originW<=i&&this.calc.originH<=e?this.calc.lastW=this.calc.originW:(this.calc.lastW=i,this.calc.lastW*this.calc.originRatio>e&&(this.calc.lastW=e/this.calc.originRatio));var s=this.calc.lastW/this.calc.elW,o=this.calc.lastW*this.calc.originRatio/this.calc.elH,n=(i+this.opts.offset-this.calc.elW)/2,a=(e+this.opts.offset-this.calc.elH)/2;this.$img.style.transform="translate(".concat(n,"px, ").concat(a,"px) scale(").concat(s,", ").concat(o,")"),this.$backdrop.classList.remove(p)}},{key:"_update",value:function(t){var i=this;this.$el=t,this._inactive();var e=new Image,s=this.$el.getAttribute("src");e.src=s,e.onload=function(){i.$img.src=s,i.calc.originW=e.width,i.calc.originH=e.height,i.calc.originRatio=e.height/e.width,i.$img.onload=function(){i.status=g,i._active()}},e.onerror=console.error}},{key:"_statusHandle",value:function(t){status=t,this.status===f?(this.opts.onDisappeared&&this.opts.onDisappeared(),this.opts.hide&&this.$el.classList.remove(p),this.$lightbox.classList.add(d),this.$img.style.willChange="auto",document.documentElement.classList.remove(u),window.removeEventListener("touchmove",c),window.removeEventListener("resize",a(33,this._active.bind(this))),this.calc={},this.$el=void 0):(this.status===g?(this.opts.onShowing&&this.opts.onShowing(),this.opts.hide&&this.$el.classList.add(p),this.$lightbox.classList.remove(d)):this.status===m?this.opts.onShowed&&this.opts.onShowed():this.status===v&&(this.opts.onDisappearing&&this.opts.onDisappearing(),this._inactive()),this.$img.style.willChange="transform",document.documentElement.classList.add(u),window.addEventListener("touchmove",c),window.addEventListener("resize",a(33,this._active.bind(this))))}},{key:"option",value:function(i){i&&Object.keys(i).map(function(t){if(Object.hasOwnProperty.call(b,t)&&"function"!=typeof i[t])throw TypeError("".concat(t," has to be a function."))});return this.opts=Object.assign({},this.initial,i),this.$lightbox&&this._setDuration(),this}},{key:"start",value:function(){var s=this;this._build(),this._listen(),window.addEventListener("click",function(t){var i=t.target,e=i.getAttribute("xz-lightbox");i.tagName&&"IMG"===i.tagName.toUpperCase()&&"object"!==o(e)&&s._update(i)},!1)}}])&&n(i.prototype,e),s&&n(i,s),t}())});
